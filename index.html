
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game Dashboard</title>
<style>
:root {
  /* Core Colors*/
  --background: #141414;
  --card: #1E1E1E;
  --card-inlay: #1a1a1a;
  --button: #262626;
  --hover: #383838;
  --border: #222;
  --radius: 8px;
  
  /* Fonts */
  --font-main: Arial, sans-serif;
  --font-size-small: 14px;
  --font-size-medium: 16px;
  --font-size-large: 18px;
  --font-size-extra-large: 24px;

  /* Text Colors */
  --text: #fff;
  --text-muted: #999;

  /* Status Colors */
  --status-completed: #278041;
  --status-inprogress: #1177a3;
  --status-notstarted: #616161;
  --status-onhold: #a62327;
  --status-hundred: #689a2e;
  --progressbar: #4caf50;
  --status-text: var(--text);
}

body {
  margin: 0;
  margin-bottom: 120px;
  background: var(--background);
  font-family: var(--font-main);
  color: var(--text);
}

/* Navigation */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 40px;
  border-bottom: 1px solid var(--border);
}
.navbar .logo { font-size: var(--font-size-extra-large); font-weight: bold;}
.navbar .menu { display: flex; gap: 30px; }
.navbar .menu a {
  color: var(--text-muted);
  text-decoration: none;
  font-size: var(--font-size-medium);
  cursor: pointer;
}
.navbar .menu a.active { color: var(--text); }
.navbar .profile { display: flex; align-items: center; gap: 10px; }

/* Layout */
.container {
  max-width: 1920px;
  width: 100%;
  margin: 60px auto 0;
  padding: 0 20px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 25px;
  margin-top: 30px;
}
.grid2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 25px;
  margin-top: 30px;
}

/* Cards */
.card {
  background: var(--card);
  padding: 20px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: 0 3px 10px rgba(0,0,0,0.06);
}
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  gap: 10px;
}
.card-header h3 {
  margin: 0;
  font-size: var(--font-size-large);
}

/* Charts */
.chart-status,
.chart-platform,
.card canvas {
  display: block;
  margin: 0 auto;
  width: 100% !important;
  max-height: 250px;
}

.games { grid-column: span 2; }

/* Buttons */
.button-report,
.button-delete svg {
  background: var(--button);
  padding: 6px 12px;
  border-radius: var(--radius);
  font-size: var(--font-size-small);
  cursor: pointer;
  color: var(--text);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.button-report:hover,
.button-delete svg:hover {
  background: var(--hover);
}

/* Table */
table { width: 100%; border-collapse: collapse; }
table td, table th {
  padding: 12px 6px;
  border-bottom: 1px solid var(--border);
  font-size: var(--font-size-small);
}
table th { color: var(--text-muted); text-align: left; }

/* Lists */
ul { padding-left: 20px; }
ul li { margin-bottom: 8px; font-size: var(--font-size-medium); }

/* Scroll */
.scrollable-list-small,
.scrollable-list-large {
  margin-top: 12px;
  overflow-y: auto;
  padding-right: 8px;
  scrollbar-color: var(--hover) var(--card-inlay);
}
.scrollable-list-small { max-height: 160px; }
.scrollable-list-large { max-height: 400px; }

#gameSearch, #wishlistSearch { padding:6px; width:300px; border-radius: var(--radius); border:1px solid var(--border); background: var(--card-inlay); color: var(--text); font-size:var(--font-size-small); }

/* Selects */
.statusSelect,
.monthSelect,
.yearSelect {
  padding: 6px 12px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  font-size: var(--font-size-small);
  background: var(--button);
  color: var(--text-muted);
}

.statusSelect {
  color: var(--status-text);
}

/* Status Colors */
.statusNotStarted { background: var(--status-notstarted); }
.statusInProgress { background: var(--status-inprogress); }
.statusCompleted { background: var(--status-completed); }
.statusOnHold { background: var(--status-onhold); }
.statusHundred { background: var(--status-hundred); }

/* Progress Bar */
.progress-bar {
  background: var(--card-inlay);
  width: 100%;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  margin-top: 10px;
}
.progress-bar-fill {
  background: var(--progressbar);
  height: 100%;
  width: 0%;
  transition: width 0.4s ease;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 40;
}
.modal-content {
  background: var(--card);
  padding: 20px;
  border-radius: var(--radius);
  width: 320px;
  max-width: 95%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.modal-content input {
  padding: 8px;
  border-radius: var(--radius);
  border: none;
  font-size: var(--font-size-small);
  background: var(--card-inlay);
  color: var(--text);
}
.modal-content select,
.modal-content button {
  padding: 8px;
  border-radius: var(--radius);
  border: none;
  font-size: var(--font-size-small);
  background: var(--button);
  color: var(--text);
}
#closeModal,
#closeAccountModal { background: var(--button); }
#confirmAddGame { background: var(--status-completed); }
#saveProfile { background: var(--status-completed); }

/* Cerulean Theme */
body.alt-theme {
  /* Core Colors */
  --background: #0F1C23;
  --card: #162933;
  --card-inlay: #13262C;
  --button: #1D3B48;
  --hover: #2A4F63;
  --border: #1A3642;
  --radius: 8px;

  /* Text Colors */
  --text: #fff;
  --text-muted: #999;
  
  /* Status Colors */
  --status-text: var(--text);
}

/* Scandi Theme */
body.scandi-theme {
  /* Core Colors */
  --background: #efe8dd;
  --card: #cab3a0;
  --card-inlay: #decabd;
  --button: #decabd;
  --hover: #edeae5;
  --border: #decabd;
  --radius: 8px;

  /* Text Colors */
  --text: #434341;
  --text-muted: #373A3A;
  
  /* Status Colors */
  --status-text: var(--hover);
}

/* Scandi Theme */
body.discord-theme {
  /* Core Colors */
  --background: #121214;
  --card: #1A1A1E;
  --card-inlay: #17171B;
  --button: #212125;
  --hover: #323235;
  --border: #222;
  --radius: 8px;

  /* Text Colors */
  --text: #fff;
  --text-muted: #999;
  
  /* Status Colors */
  --status-text: var(--hover);
}

/* Responsive */
@media (max-width:900px){
  .grid { grid-template-columns: 1fr; }
  .games { grid-column: auto; }
}

#importBtn .material-symbols-outlined {
  font-size: 18px;
  vertical-align: middle;
  line-height: 0;
}

#exportBtn .material-symbols-outlined {
  font-size: 18px;
  vertical-align: middle;
  line-height: 0;
}

#openAddGame .material-symbols-outlined {
  font-size: 18px;
  vertical-align: middle;
  line-height: 0;
}

.card .material-symbols-outlined {
  font-size: 24px;
  vertical-align: bottom;
  line-height: 1;
}

.button-delete .material-symbols-outlined {
  background: var(--button);
  padding: 6px 12px;
  border-radius: var(--radius);
  font-size: var(--font-size-extra-large);
  cursor: pointer;
  color: var(--text);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.button-delete .material-symbols-outlined:hover {
  background: var(--hover);
}

.menu .material-symbols-outlined {
  font-size: 24px;
  vertical-align: middle;
  line-height: 0;
}

</style>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=add,check,delete,download,list,progress_activity,settings,upload" />

</head>
<body>

<div class="navbar">
  <div class="logo">.games</div>
  <div class="menu">
    <a class="active" href="#">Dashboard</a>
    <a href="#">Wishlist</a>
    <a href="#">Stats</a>
    <a href="#" id="openSettingsModal">Settings</a>
    <a href="#">Account</a>
  </div>
  <div class="profile">
    <span id="profileNameDisplay">Lepehn</span>
    <div id="profileAvatar" style="width:32px;height:32px;background-image:url('https://avatars.fastly.steamstatic.com/509fdfc9a110f100337ea9265c5bc235db7b7bab_full.jpg');background-size:100% 100%;border-radius:50%"></div>
  </div>
</div>

<div class="container">
  <!-- Dashboard content -->
  <div id="dashboardContent">
    <h1>Dashboard</h1>
    <p>Hi <span id="welcomeName">Lepehn</span>, here are your games</p>

    <div class="grid">
      <div class="card">
        <div class="card-header"><h3><span class="material-symbols-outlined">check</span> Recently Played Games</h3></div>
        <div class="scrollable-list-small" id="recentlyPlayed"></div>
      </div>

      <div class="card">
        <div class="card-header"><h3><span class="material-symbols-outlined">progress_activity</span> Games In Progress</h3></div>
        <div class="scrollable-list-small" id="inProgress"></div>
      </div>

      <div class="card">
        <div class="card-header"><h3><span class="material-symbols-outlined">list</span> Summary</h3></div>
        <ul id="summary"></ul>
      </div>

      <div class="card games">
        <div class="card-header">
          <h3>Games</h3>
          <span class="button-report" id="exportBtn">          
           <span class="material-symbols-outlined">download</span>Export
          </span>
          
          <span class="button-report" id="importBtn">
           <span class="material-symbols-outlined">upload</span>Import
          </span>
          
          <span class="button-report" id="openAddGame">
           <span class="material-symbols-outlined">add</span>Add
          </span>
          
          <input type="file" id="importJSON" accept=".json" style="display:none;">
          <input type="text" id="gameSearch" placeholder="Search games...">
        </div>
        <div class="scrollable-list-large">
          <table id="gamesTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Platform</th>
                <th>Status</th>
                <th>Month</th>
                <th>Year</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card" style="max-height:120px">
        <div class="card-header"><h3>Completion Goal</h3></div>
        <div class="completion-goal" id="completionText"></div>
        <div class="progress-bar">
          <div class="progress-bar-fill" id="completionBar"></div>
        </div>
      </div>
    </div>
  </div>
  
    <!-- Wishlist content -->
  <div id="wishlistContent" style="display:none;">
    <h1>Wishlist</h1>
    <p>Hi <span id="welcomeName">Lepehn</span>, here is your wishlist</p>
    <div class="grid">
    <div class="card games">
        <div class="card-header">
          <h3>Games</h3>
          <span class="button-report" id="openAddWishlistGame"><span class="material-symbols-outlined">add</span>Add</span>
          <input type="text" id="wishlistSearch" placeholder="Search games...">
        </div>
        <div class="scrollable-list-large">
          <table id="gamesWishlistTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
       </div>
     </div>
    </div>
</div>

  <!-- Stats content -->
  <div id="statsContent" style="display:none;">
    <h1>Game Stats</h1>
    <p>Hi <span id="welcomeName">Lepehn</span>, here are your gaming stats</p>
    <div class="grid2">
      <div class="card" style="max-height:360px">
        <div class="card-header"><h3>Games by Status</h3></div>
        <canvas id="statusChart" class="chart-status"></canvas>
      </div>
      <div class="card" style="max-height:360px">
        <div class="card-header"><h3>Games by Platform</h3></div>
        <canvas id="platformChart" class="chart-platform"></canvas>
      </div>
      <div class="card" style="max-height:360px">
        <div class="card-header"><h3>Games by Year</h3></div>
        <canvas id="yearChart"></canvas>
      </div>
      <div class="card" style="max-height:360px">
        <div class="card-header"><h3>Games by Month <span id="currentYear"></span></h3></div>
        <canvas id="monthChart"></canvas>
      </div>
      <div class="card" style="max-height:120px">
        <div class="card-header"><h3>Completion Goal</h3></div>
        <div class="completion-goal" id="completionTextStats"></div>
        <div class="progress-bar">
      		<div class="progress-bar-fill" id="completionBarStats"></div>
       </div>
      </div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal">
  <div class="modal-content">
    <h3>Settings</h3>

    <h4>Choose Theme</h4>
    <button class="theme-btn" data-theme="default">Woodsmoke</button>
    <button class="theme-btn" data-theme="alt">Cerulean</button>
    <button class="theme-btn" data-theme="scandi">Scandi</button>
    <button class="theme-btn" data-theme="discord-dark">Discord Dark</button>

    <button id="closeSettingsModal">Close</button>
  </div>
</div>

<!-- Add Game Modal -->
<div id="addGameModal" class="modal">
  <div class="modal-content">
    <h3>Add New Game</h3>
    <input type="text" id="modalGameName" placeholder="Game Name" />
    <input type="text" id="modalGamePlatform" placeholder="Platform (steam, xbox, nintendo...)" />
    <select id="modalGameStatus" class="statusSelect">
      <option value="NotStarted">Not Started</option>
      <option value="InProgress">In Progress</option>
      <option value="OnHold">On Hold</option>
      <option value="Completed">Completed</option>
      <option value="Hundred">100%</option>
    </select>

    <div style="display:flex; gap:8px;">
      <select id="modalGameMonth" class="monthSelect" style="flex:1;">
        <option value="">Month</option>
      </select>
      <select id="modalGameYear" class="yearSelect" style="width:120px;">
        <option value="">Year</option>
      </select>
    </div>

    <button id="confirmAddGame">Add Game</button>
    <button id="closeModal">Cancel</button>
  </div>
</div>

<!-- Account Modal -->
<div id="accountModal" class="modal">
  <div class="modal-content">
    <h3>Edit Profile</h3>
    <div style="display:flex; justify-content:center; margin-bottom:10px;">
      <div id="profilePreview" style="width:80px; height:80px; border-radius:50%; background-size:100% 100%; background-image:url('https://avatars.fastly.steamstatic.com/509fdfc9a110f100337ea9265c5bc235db7b7bab_full.jpg');"></div>
    </div>
    <input type="text" id="profileNameInput" placeholder="Display Name" />
    <input type="file" id="profileImageInput" accept="image/*" />
    <button id="saveProfile">Save</button>
    <button id="closeAccountModal">Cancel</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ---------- configuration ---------- */
const MONTHS = [
  "Jan","Feb","Mar","Apr","May","Jun",
  "Jul","Aug","Sep","Oct","Nov","Dec"
];
const YEAR_START = 1980;
const YEAR_END = new Date().getFullYear();

/* ---------- storage ---------- */
const gameData = JSON.parse(localStorage.getItem('gameData')) || { prefix: 'gameBacklog', epic: [], nintendo: [], playstation: [], steam: [], xbox: [], wishlist: [] };
function saveGames(){ localStorage.setItem('gameData', JSON.stringify(gameData)); }

/* ---------- helpers ---------- */
function escapeHtml(str){
  return String(str || '').replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
}

function makeMonthOptions(selectedMonth) {
  let opts = `<option value="">Month</option>`;
  MONTHS.forEach(m => {
    opts += `<option value="${m}" ${m===selectedMonth ? 'selected' : ''}>${m}</option>`;
  });
  return opts;
}

function makeYearOptions(selectedYear) {
  let opts = `<option value="">Year</option>`;
  for (let y = YEAR_END; y >= YEAR_START; --y) {
    opts += `<option value="${y}" ${String(y)===String(selectedYear) ? 'selected' : ''}>${y}</option>`;
  }
  return opts;
}

/*----------- stats ----------*/
let statusChart, platformChart, yearChart, monthChart;

function updateStats() {
  const statusCount = { Completed:0, InProgress:0, NotStarted:0, OnHold:0, Hundred:0};
  const platformCount = {};
  const yearCount = {};
  const monthCount = {};
  
  Object.keys(gameData).forEach(platform=>{
    if(platform==='prefix') return;
    platformCount[platform] = gameData[platform].length || 0;
    gameData[platform].forEach(g=>{
      statusCount[g.status] = (statusCount[g.status]||0)+1;
      if(g.year) yearCount[g.year] = (yearCount[g.year]||0)+1;
      if(g.month) monthCount[g.month] = (monthCount[g.month]||0)+1;
    });
  });

  const statusLabels = Object.keys(statusCount).map(label =>
  label === "Hundred" ? "100%" : label
);
  const statusValues = Object.values(statusCount);

  const platformLabels = Object.keys(platformCount);
  const platformValues = Object.values(platformCount);

  const yearLabels = Object.keys(yearCount).sort((a,b)=>b-a);
  const yearValues = yearLabels.map(y=>yearCount[y]);

  const MONTHS_FULL =["January","February","March","April","May","June","July","August","September","October","November","December"];
  const MONTHS_SHORT = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  const currentYear = new Date().getFullYear().toString();
  document.getElementById("currentYear").textContent = `(${new Date().getFullYear()})`;

  const monthValues = MONTHS_SHORT.map(short => {
    let count = 0;

    Object.keys(gameData).forEach(platform => {
      if(platform === 'prefix') return;

      gameData[platform].forEach(g => {
        if (g.year === currentYear && g.month === short) {
          count++;
        }
      });
    });

    return count;
  });
  
  const monthLabels = MONTHS_FULL; // Add this line before creating monthChart

  // Destroy previous charts if they exist
  if(statusChart) statusChart.destroy();
  if(platformChart) platformChart.destroy();
  if(yearChart) yearChart.destroy();
  if(monthChart) monthChart.destroy();

  const ctxStatus = document.getElementById('statusChart').getContext('2d');
  const ctxPlatform = document.getElementById('platformChart').getContext('2d');
  const ctxYear = document.getElementById('yearChart').getContext('2d');
  const ctxMonth = document.getElementById('monthChart').getContext('2d');
  
  const cardInlay = getComputedStyle(document.documentElement).getPropertyValue('--card-inlay').trim();
  const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--background').trim();
  const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text').trim();
  
  Chart.defaults.color = textColor;
  
  statusChart = new Chart(ctxStatus, {
    type:'doughnut',
    data:{ labels:statusLabels, datasets:[{ data:statusValues, backgroundColor:['#278041','#1177a3','#616161','#a62327', '#689a2e'] }]},
    options:{ responsive:true, plugins:{ legend:{ position:'right' } } }
  });

  platformChart = new Chart(ctxPlatform, {
    type:'doughnut',
    data:{ labels:platformLabels, datasets:[{ data:platformValues, backgroundColor:['#ff5722','#2196f3','#4caf50','#9c27b0','#00bcd4'] }]},
    options:{ responsive:true, plugins:{ legend:{ position:'right' } } }
  });

  yearChart = new Chart(ctxYear, {
  type: 'bar',
  data: { labels: yearLabels, datasets: [{ label: 'Games', data: yearValues, backgroundColor: '#1177a3' }]},
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0, callback: value => Number.isInteger(value) ? value : null }, grid: { color: gridColor }}, x: { grid: { color: gridColor } } } },
  plugins: [{ beforeDraw: (chart) => { const ctx = chart.ctx; ctx.save(); ctx.fillStyle = cardInlay; ctx.fillRect(0, 0, chart.width, chart.height); ctx.restore(); } } ]
  });

  monthChart = new Chart(ctxMonth, {
    type: 'bar',
    data: { labels: monthLabels, datasets: [{ label: 'Games', data: monthValues, backgroundColor: '#1177a3' }]},
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0, callback: value => Number.isInteger(value) ? value : null }, grid: { color: gridColor }}, x: { grid: { color: gridColor } } } },
    plugins: [{ beforeDraw: (chart) => { const ctx = chart.ctx; ctx.save(); ctx.fillStyle = cardInlay; ctx.fillRect(0, 0, chart.width, chart.height); ctx.restore(); } } ]
    });
 }

/* ---------- update UI ---------- */
function updateUI() {
  const tbody = document.querySelector('#gamesTable tbody');
  const recentList = document.getElementById('recentlyPlayed');
  const inProgressList = document.getElementById('inProgress');
  const summaryBox = document.getElementById('summary');
  const completionText = document.getElementById('completionText');
  const completionBar = document.getElementById('completionBar');
  const completionTextStats = document.getElementById('completionTextStats');
  const completionBarStats = document.getElementById('completionBarStats');

  // clear old content
  tbody.innerHTML = '';
  recentList.innerHTML = '';
  inProgressList.innerHTML = '';
  summaryBox.innerHTML = '';

  let totalGames = 0;
  let completed = 0;
  let inProgress = 0;
  let notStarted = 0;
  let onHold = 0;
  let hundred = 0;

  // prebuild month/year options for reuse
  const monthOptionsHTML = makeMonthOptions('');
  const yearOptionsHTML = makeYearOptions('');

  const tbodyFrag = document.createDocumentFragment();
  const recentFrag = document.createDocumentFragment();
  const inProgressFrag = document.createDocumentFragment();

  Object.keys(gameData).forEach(platform => {
    if (platform === 'prefix'|| platform === 'wishlist') return;

    gameData[platform].forEach((g, index) => {
      totalGames++;

      const month = g.month || '';
      const year = g.year || '';

      // create table row
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(g.title)}</td>
        <td>${platform}</td>
        <td>
          <select class="statusSelect status${g.status}" data-platform="${platform}" data-index="${index}">
            <option value="NotStarted" ${g.status==='NotStarted'?'selected':''}>Not Started</option>
            <option value="InProgress" ${g.status==='InProgress'?'selected':''}>In Progress</option>
            <option value="OnHold" ${g.status==='OnHold'?'selected':''}>On Hold</option>
            <option value="Completed" ${g.status==='Completed'?'selected':''}>Completed</option>
            <option value="Hundred" ${g.status==='Hundred'?'selected':''}>100%</option>
          </select>
        </td>
        <td>
          <select class="monthSelect" data-platform="${platform}" data-index="${index}">
            ${makeMonthOptions(month)}
          </select>
        </td>
        <td>
          <select class="yearSelect" data-platform="${platform}" data-index="${index}">
            ${makeYearOptions(year)}
          </select>
        </td>
        <td>
          <span class="button-delete" data-platform="${platform}" data-index="${index}"><span class="material-symbols-outlined">delete</span>
          </span>
        </td>
      `;
      tbodyFrag.appendChild(tr);

      // count statuses and append to fragments
      switch(g.status) {
        case 'Completed':
          completed++;
          const recentLi = document.createElement('li');
          recentLi.textContent = month && year ? `${g.title} — ${month} ${year}` : g.title;
          recentFrag.appendChild(recentLi);
          break;
        case 'InProgress':
          inProgress++;
          const inProgressLi = document.createElement('li');
          inProgressLi.textContent = g.title;
          inProgressFrag.appendChild(inProgressLi);
          break;
        case 'NotStarted': notStarted++; break;
        case 'OnHold': onHold++; break;
        case 'Hundred':
          completed++;
          hundred++;
          const recentLi2 = document.createElement('li');
          recentLi2.textContent = month && year ? `${g.title} — ${month} ${year}` : g.title;
          recentFrag.appendChild(recentLi2);
          break;
      }
    });
  });

  // append fragments to DOM in one go
  tbody.appendChild(tbodyFrag);
  recentList.appendChild(recentFrag);
  inProgressList.appendChild(inProgressFrag);

  // completion bar
  const percent = totalGames ? (completed/totalGames)*100 : 0;
  if(completionBar) completionBar.style.width = percent+'%';
  if(completionText) completionText.textContent = `${completed} / ${totalGames} Completed`;

  if(completionBarStats) completionBarStats.style.width = percent+'%';
  if(completionTextStats) completionTextStats.textContent = `${completed} / ${totalGames} Completed`;

  // summary
  if(summaryBox){
    summaryBox.innerHTML = `
      <li>Total Games: ${totalGames}</li>
      <li>100%: ${hundred}</li>
      <li>Completed: ${completed}</li>
      <li>In Progress: ${inProgress}</li>
      <li>Not Started: ${notStarted}</li>
      <li>On Hold: ${onHold}</li>
    `;
  }
  
  // If user typed in search, reapply it
  const query = searchInput.value.toLowerCase();
  if(query) {
    Array.from(tbody.querySelectorAll('tr')).forEach(row => {
      const title = row.cells[0].textContent.toLowerCase();
      const platform = row.cells[1].textContent.toLowerCase();
      const status = row.cells[2].querySelector('select').value.toLowerCase();
      const month = row.cells[3].querySelector('select').value.toLowerCase();
      const year = row.cells[4].querySelector('select').value.toLowerCase();

      row.style.display = (title.includes(query) || platform.includes(query) || status.includes(query) || month.includes(query) || year.includes(query)) ? '' : 'none';
    });
  }
}

// Update Wishlist
function updateWishlistUI() {
  const tbody = document.querySelector('#gamesWishlistTable tbody');
  tbody.innerHTML = '';

  gameData.wishlist.forEach((g, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(g.title)}</td>
      <td>
        <span class="button-delete" data-type="wishlist" data-index="${index}"><span class="material-symbols-outlined">delete</span>
        </span>
      </td>
    `;
    tbody.appendChild(tr);
  });
    // If user typed in search, reapply it
  const query = wishlistSearchInput.value.toLowerCase();
  if(query) {
    Array.from(tbody.querySelectorAll('tr')).forEach(row => {
      const title = row.cells[0].textContent.toLowerCase();
      row.style.display = title.includes(query) ? '' : 'none';
    });
  }
}

// Search
const searchInput = document.getElementById('gameSearch');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  const tbody = document.querySelector('#gamesTable tbody');

  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    const title = row.cells[0]?.textContent.toLowerCase() || '';
    const platform = row.cells[1]?.textContent.toLowerCase() || '';

    // safe access to selects (may be missing in some row types)
    const statusSelect = row.cells[2]?.querySelector('select');
    const monthSelect = row.cells[3]?.querySelector('select');
    const yearSelect = row.cells[4]?.querySelector('select');

    const statusVal = (statusSelect?.value || '').toLowerCase();
    // human-friendly label for matching (so "hundred" matches "100%")
    let statusLabel = statusVal;
    if (statusVal === 'hundred') statusLabel = '100%';
    if (statusVal === 'inprogress') statusLabel = 'in progress';
    if (statusVal === 'notstarted') statusLabel = 'not started';
    if (statusVal === 'onhold') statusLabel = 'on hold';
    if (statusVal === 'completed') statusLabel = 'completed';

    const month = (monthSelect?.value || '').toLowerCase();
    const year = (yearSelect?.value || '').toLowerCase();

    const match =
      title.includes(query) ||
      platform.includes(query) ||
      statusVal.includes(query) ||
      statusLabel.includes(query) ||
      month.includes(query) ||
      year.includes(query);

    row.style.display = match ? '' : 'none';
  });
});

const wishlistSearchInput = document.getElementById('wishlistSearch');

wishlistSearchInput.addEventListener('input', () => {
  const query = wishlistSearchInput.value.toLowerCase();
  const tbody = document.querySelector('#gamesWishlistTable tbody');

  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    const title = row.cells[0]?.textContent.toLowerCase() || '';
    const platform = row.cells[1]?.textContent.toLowerCase() || '';
    
    // Only try to read selects if they exist
    const status = row.cells[2]?.querySelector('select')?.value.toLowerCase() || '';
    const month = row.cells[3]?.querySelector('select')?.value.toLowerCase() || '';
    const year = row.cells[4]?.querySelector('select')?.value.toLowerCase() || '';

    if (title.includes(query) || platform.includes(query) || status.includes(query) || month.includes(query) || year.includes(query)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
});

/* ---------- theme handling -----------*/
const SettingsModal = document.getElementById("settingsModal");
const openSettings = document.getElementById("openSettingsModal");
const closeSettings = document.getElementById("closeSettingsModal");

// Open modal
openSettings.addEventListener("click", (e) => {
  e.preventDefault();
  SettingsModal.style.display = "flex";
});

// Close modal
closeSettings.addEventListener("click", () => {
  SettingsModal.style.display = "none";
});

// Click outside modal closes it
SettingsModal.addEventListener("click", (e) => {
  if (e.target === SettingsModal) SettingsModal.style.display = "none";
});

// Theme buttons
document.querySelectorAll(".theme-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const theme = btn.dataset.theme;

    if (theme === "alt") {
      document.body.classList.add("alt-theme");
    } else {
      document.body.classList.remove("alt-theme");
    }
    
    if (theme === "scandi") {
      document.body.classList.add("scandi-theme");
    } else {
      document.body.classList.remove("scandi-theme");
    }

    if (theme === "discord-dark") {
      document.body.classList.add("discord-theme");
    } else {
      document.body.classList.remove("discord-theme");
    }

    localStorage.setItem("theme", theme);
  });
});

// Load saved theme
if (localStorage.getItem("theme") === "alt") {
  document.body.classList.add("alt-theme");
}

if (localStorage.getItem("theme") === "scandi") {
  document.body.classList.add("scandi-theme");
}

/* ---------- tab handling -----------*/
const dashboardContent = document.getElementById('dashboardContent');
const statsContent = document.getElementById('statsContent');
const wishlistContent = document.getElementById('wishlistContent');

const menuLinks = document.querySelectorAll('.navbar .menu a');
const dashboardLink = [...menuLinks].find(a => a.textContent.trim() === 'Dashboard');
const statsLink = [...menuLinks].find(a => a.textContent.trim() === 'Stats');
const wishlistLink = [...menuLinks].find(a => a.textContent.trim() === 'Wishlist');

function showDashboard() {
  dashboardContent.style.display = 'block';
  statsContent.style.display = 'none';
  wishlistContent.style.display = 'none';
  dashboardLink.classList.add('active');
  statsLink.classList.remove('active');
  wishlistLink.classList.remove('active');
}

function showStats() {
  dashboardContent.style.display = 'none';
  statsContent.style.display = 'block';
  wishlistContent.style.display = 'none';
  statsLink.classList.add('active');
  dashboardLink.classList.remove('active');
  wishlistLink.classList.remove('active');
  updateStats();
}

function showWishlist() {
  dashboardContent.style.display = 'none';
  statsContent.style.display = 'none';
  wishlistContent.style.display = 'block';
  wishlistLink.classList.add('active');
  dashboardLink.classList.remove('active');
  statsLink.classList.remove('active');
  updateWishlistUI();
}

dashboardLink.addEventListener('click', e => { e.preventDefault(); showDashboard(); });
statsLink.addEventListener('click', e => { e.preventDefault(); showStats(); });
wishlistLink.addEventListener('click', e => { e.preventDefault(); showWishlist(); });

/* ---------- table change handling ---------- */
document.getElementById('gamesTable').addEventListener('change', e => {
  const sel = e.target.closest('.statusSelect, .monthSelect, .yearSelect');
  if(!sel) return;

  const platform = sel.dataset.platform;
  const idx = Number(sel.dataset.index);
  if(isNaN(idx)) return;

  const g = gameData[platform][idx];

  if(sel.classList.contains('statusSelect')) g.status = sel.value;
  else if(sel.classList.contains('monthSelect')) g.month = sel.value;
  else if(sel.classList.contains('yearSelect')) g.year = sel.value;

  saveGames();
  updateUI();
});

/* ---------- delete handling ---------- */
document.getElementById('gamesTable').addEventListener('click', e => {
  const btn = e.target.closest('.button-delete');
  if(!btn) return;

  const platform = btn.dataset.platform;
  const idx = Number(btn.dataset.index);
  if(isNaN(idx)) return;

  gameData[platform].splice(idx,1);
  saveGames();
  updateUI();
});

// Delete from wishlist
document.getElementById('gamesWishlistTable').addEventListener('click', e => {
  const btn = e.target.closest('.button-delete');
  if (!btn) return;

  const idx = Number(btn.dataset.index);
  if (isNaN(idx)) return;

  gameData.wishlist.splice(idx, 1);
  saveGames();
  updateWishlistUI();
});

/* ---------- profile handling ---------- */
const profileNameEl = document.querySelector('.navbar .profile span');
const profileAvatarEl = document.querySelector('.navbar .profile div');
const welcomeNameEl = document.getElementById('welcomeName');
const savedProfile = JSON.parse(localStorage.getItem('profileData'));
if (savedProfile) {
  profileNameEl.textContent = savedProfile.name || profileNameEl.textContent;
  profileAvatarEl.style.backgroundImage = savedProfile.avatar || profileAvatarEl.style.backgroundImage;
  welcomeNameEl.textContent = savedProfile.name || welcomeNameEl.textContent;
  const preview = document.getElementById('profilePreview');
  if (preview) preview.style.backgroundImage = savedProfile.avatar || preview.style.backgroundImage;
}

/* ---------- Account Modal Logic ---------- */
const accountModal = document.getElementById('accountModal');
const profileNameInput = document.getElementById('profileNameInput');
const profileImageInput = document.getElementById('profileImageInput');
const profilePreview = document.getElementById('profilePreview');
const saveProfileBtn = document.getElementById('saveProfile');
const closeAccountModal = document.getElementById('closeAccountModal');

// Open account modal
document.querySelector('.navbar .menu a[href="#"]:last-child').addEventListener('click', () => {
  profileNameInput.value = profileNameEl.textContent;
  accountModal.style.display = 'flex';
});

// Preview new image
profileImageInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    profilePreview.style.backgroundImage = `url('${ev.target.result}')`;
  };
  reader.readAsDataURL(file);
});

// Save profile changes
saveProfileBtn.addEventListener('click', () => {
  const newName = profileNameInput.value.trim() || profileNameEl.textContent;
  const newAvatar = profilePreview.style.backgroundImage || profileAvatarEl.style.backgroundImage;

  profileNameEl.textContent = newName;
  profileAvatarEl.style.backgroundImage = newAvatar;
  welcomeNameEl.textContent = newName;

  localStorage.setItem('profileData', JSON.stringify({ name: newName, avatar: newAvatar }));
  accountModal.style.display = 'none';
});

// Close modal
closeAccountModal.addEventListener('click', () => accountModal.style.display = 'none');
accountModal.addEventListener('click', e => {
  if (e.target === accountModal) accountModal.style.display = 'none';
});

/* ---------- add game modal ---------- */
const modal = document.getElementById('addGameModal');
const openAddWishlistGameBtn = document.getElementById("openAddWishlistGame");
const openBtn = document.getElementById('openAddGame');
const closeBtn = document.getElementById('closeModal');
const confirmAdd = document.getElementById('confirmAddGame');
const modalName = document.getElementById('modalGameName');
const modalPlatform = document.getElementById('modalGamePlatform');
const modalStatus = document.getElementById('modalGameStatus');
const modalMonth = document.getElementById('modalGameMonth');
const modalYear = document.getElementById('modalGameYear');

let addingToWishlist = false;

modalMonth.innerHTML = makeMonthOptions('');
modalYear.innerHTML = makeYearOptions('');

openBtn.addEventListener('click', () => {
  addingToWishlist = false;
  modal.style.display = 'flex';
  modalName.value = '';
  modalPlatform.value = '';
  modalStatus.value = 'NotStarted';
  modalMonth.value = '';
  modalYear.value = '';
  modalPlatform.style.display = 'inline-block';
  modalStatus.style.display = 'inline-block';
  modalMonth.style.display = 'inline-block';
  modalYear.style.display = 'inline-block';
});

openAddWishlistGameBtn.addEventListener("click", () => {
  addingToWishlist = true;
  modal.style.display = "flex";
  modalName.value = '';
  modalPlatform.value = '';
  modalPlatform.style.display = 'none';
  modalStatus.style.display = 'none';
  modalMonth.style.display = 'none';
  modalYear.style.display = 'none';
});

closeBtn.addEventListener('click', () => modal.style.display = 'none');
modal.addEventListener('click', e => { if(e.target === modal) modal.style.display='none'; });

confirmAdd.addEventListener('click', () => {
  const name = modalName.value.trim();
  const platform = modalPlatform.value.trim();
  if (!name) return;
  if (!addingToWishlist && !platform) return;

if (addingToWishlist) {
  if (!gameData.wishlist) gameData.wishlist = [];
  gameData.wishlist.push({ title: name });
  saveGames();
  updateWishlistUI();
} else {
    const status = modalStatus.value;
    const month = modalMonth.value;
    const year = modalYear.value;
    gameData[platform.toLowerCase()].push({
      title: name, status, month, year
    });
    saveGames();
    updateUI();
  }

  modal.style.display = "none";
  addingToWishlist = false; // reset after adding
});

/* ---------- import/export ---------- */
const importBtn = document.getElementById('importBtn');
const importInput = document.getElementById('importJSON');
const exportBtn = document.getElementById('exportBtn');

importBtn.addEventListener('click', () => importInput.click());
importInput.addEventListener('change', function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    try{
      const data = JSON.parse(ev.target.result);
      ['epic','nintendo','playstation','steam','xbox', 'wishlist'].forEach(platform => {
        if(Array.isArray(data[platform])){
          data[platform].forEach(game => {
            const exists = gameData[platform]?.some(g=> g.title===game.title && g.month===game.month && g.year===game.year);
            if(!exists){
              if(!gameData[platform]) gameData[platform] = [];
              gameData[platform].push({
                title: game.title,
                status: game.status || 'NotStarted',
                month: game.month || '',
                year: game.year || ''
              });
            }
          });
        }
      });
      saveGames();
      updateUI();
    }catch(err){
      console.error(err);
    }
  };
  reader.readAsText(file);
  e.target.value = '';
});

exportBtn.addEventListener('click', ()=>{
  const exportData = { prefix:'gameBacklog', epic:[], nintendo:[], playstation:[], steam:[], xbox:[], wishlist:[] };
  ['epic','nintendo','playstation','steam','xbox', 'wishlist'].forEach(platform=>{
    if(gameData[platform]) gameData[platform].forEach(g=>{
      exportData[platform].push({
        title: g.title,
        status: g.status,
        month: g.month || '',
        year: g.year || ''
      });
    });
  });
  const blob = new Blob([JSON.stringify(exportData,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download='gameBacklog.json';
  a.click();
  URL.revokeObjectURL(url);
});

/* ---------- init ---------- */
updateUI();
</script>
</body>
</html>
